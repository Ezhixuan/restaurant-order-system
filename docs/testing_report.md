# 餐厅点餐系统功能测试报告

**测试时间**: 2026-02-26
**测试环境**:
- 后端: Spring Boot 3.1.12 (端口8080)
- 前端: Vue 3 + Vite (端口5173)
- 数据库: MySQL 8.0 (端口3307)

---

## 一、测试流程覆盖

### 1. 管理员后台流程 ✓

| 功能模块 | 测试结果 | 问题描述 |
|---------|---------|---------|
| 管理员登录 | ✓ 通过 | admin/admin123 可正常登录 |
| 数据看板 | ✓ 通过 | 页面正常显示，统计数据为0（无订单数据） |
| 桌台管理 | ✗ 失败 | 显示"加载桌台失败"，API返回403 |
| 菜品管理 | △ 部分通过 | 菜品列表显示正常，但分类列显示"-" |
| 订单管理 | ✓ 通过 | 页面正常，暂无订单数据 |
| 后厨管理 | ✓ 通过 | 页面正常显示 |
| 统计报表 | ✓ 通过 | 页面正常显示 |

**问题分析**:
桌台管理失败是因为后端Spring Security配置要求所有非 `/api/auth/**` 接口需要JWT认证。管理员登录后，浏览器会自动在后续请求中携带token，所以菜品管理能正常显示。但桌台管理的API调用可能存在问题。

---

### 2. 服务员Pad流程 ✗

| 功能模块 | 测试结果 | 问题描述 |
|---------|---------|---------|
| Pad登录 | ✗ 失败 | 提示"用户名或密码错误" |

**问题分析**:
数据库中waiter用户的密码hash与admin相同，但登录失败。可能原因：
1. 后端BCrypt密码校验失败（可能是数据库中密码hash有特殊字符转义问题）
2. 后端IDE中运行的服务可能使用了不同的数据源或缓存
3. 需要检查后端控制台日志确认具体错误

---

### 3. 顾客移动端流程 ✗

| 功能模块 | 测试结果 | 问题描述 |
|---------|---------|---------|
| 扫码进入点餐 | ✓ 通过 | 页面能正常打开，显示桌号B01 |
| 菜品展示 | ✗ 失败 | 显示"暂无菜品数据" |
| 购物车功能 | 未测试 | 因菜品无法加载 |

**问题分析**:
移动端点餐页面是公开的（router中设置了 `meta: { public: true }`），但调用 `/api/dishes` API时，后端Spring Security拦截返回403。这是一个**严重的设计缺陷**：公开页面调用的API也需要公开或需要特殊处理。

---

## 二、发现的关键问题

### 🔴 严重问题

#### 1. 移动端点餐API认证问题
**问题**: 顾客扫码点餐页面是公开的，但获取菜品列表的API需要JWT认证

**影响**: 顾客无法正常浏览菜品和下单

**修复建议**:
修改 `SecurityConfig.java`，将移动端需要的API加入白名单：
```java
.requestMatchers("/api/dishes/**").permitAll()
.requestMatchers("/api/tables/**").permitAll()
.requestMatchers("/api/orders").permitAll()
```

或者创建一个新的移动端专用API前缀，如 `/api/mobile/**`。

#### 2. 服务员账号无法登录
**问题**: waiter/123456 登录失败

**影响**: 服务员无法使用Pad点餐

**修复建议**:
1. 检查数据库中waiter用户的密码hash是否正确存储
2. 在后端添加调试日志查看具体校验失败原因
3. 重新设置waiter密码并验证

---

### 🟡 中等问题

#### 3. 桌台管理加载失败
**问题**: 桌台管理页面显示"加载桌台失败"

**修复建议**:
检查桌台列表API的调用是否正确携带token，或是否存在CORS问题。

#### 4. 菜品分类显示问题
**问题**: 菜品管理页面中分类列显示"-"

**修复建议**:
检查菜品列表API是否正确返回分类名称，或前端是否正确解析分类字段。

---

### 🟢 优化建议

#### 5. 数据看板优化
**现状**: 新安装系统后，数据看板所有统计数据为0，图表空白

**优化建议**:
- 添加"欢迎使用"引导提示
- 空状态时显示示例数据或引导添加数据的提示

#### 6. 错误提示优化
**现状**: API请求失败时，前端显示"加载失败"但不显示具体原因

**优化建议**:
- 区分网络错误、权限错误、服务器错误
- 添加重试按钮

#### 7. 移动端UI优化
**现状**: 移动端页面顶部标题栏可以优化

**优化建议**:
- 添加返回按钮
- 添加菜品分类快速导航
- 购物车悬浮按钮更加明显

---

## 三、修复优先级

| 优先级 | 问题 | 影响范围 |
|-------|------|---------|
| P0 | 移动端API认证问题 | 顾客无法点餐 |
| P0 | 服务员账号登录问题 | 服务员无法工作 |
| P1 | 桌台管理加载问题 | 管理员无法管理桌台 |
| P2 | 菜品分类显示问题 | 管理员体验 |
| P3 | 空状态引导优化 | 新用户体验 |

---

## 四、测试截图

测试过程中生成了以下截图文件：

- `/tmp/01_admin_login_page.png` - 管理员登录页
- `/tmp/02_admin_dashboard.png` - 管理后台首页
- `/tmp/03_dashboard.png` - 数据看板
- `/tmp/04_tables.png` - 桌台管理（失败）
- `/tmp/05_dishes.png` - 菜品管理
- `/tmp/06_orders.png` - 订单管理
- `/tmp/07_kitchen.png` - 后厨管理
- `/tmp/08_reports.png` - 统计报表
- `/tmp/10_pad_login.png` - Pad登录页
- `/tmp/11_pad_after_login.png` - Pad登录失败提示
- `/tmp/20_mobile_menu.png` - 移动端点餐页（无数据）

---

## 五、结论

当前系统存在**两个阻碍核心业务流程的严重问题**：
1. 顾客无法正常点餐（移动端API认证问题）
2. 服务员无法登录（账号问题）

建议优先修复这两个P0级问题，确保基本业务流程能跑通后，再进行其他功能测试。
