# 菜品份额功能数据库迁移说明

## 执行脚本

```sql
-- 1. 创建 dish_spec 表
CREATE TABLE IF NOT EXISTS dish_spec (
    id BIGINT NOT NULL AUTO_INCREMENT,
    dish_id BIGINT NOT NULL COMMENT '菜品ID',
    name VARCHAR(50) NOT NULL COMMENT '规格名称: 小份/中份/大份',
    price DECIMAL(10,2) NOT NULL,
    sort_order INT DEFAULT 0,
    status TINYINT DEFAULT 1 COMMENT '状态: 0禁用 1启用',
    is_deleted TINYINT DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (id),
    INDEX idx_dish_id (dish_id),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='菜品规格表';

-- 2. 修改 dish 表
ALTER TABLE dish ADD COLUMN IF NOT EXISTS has_specs TINYINT DEFAULT 0 COMMENT '是否有规格: 0无 1有' AFTER status;

-- 3. 修改 order_item 表
ALTER TABLE order_item ADD COLUMN IF NOT EXISTS spec_id BIGINT COMMENT '规格ID' AFTER dish_id;
ALTER TABLE order_item ADD COLUMN IF NOT EXISTS spec_name VARCHAR(50) COMMENT '规格名称快照' AFTER dish_name;

-- 4. 验证
SHOW COLUMNS FROM dish_spec;
SHOW COLUMNS FROM dish WHERE Field IN ('has_specs', 'status');
SHOW COLUMNS FROM order_item WHERE Field IN ('spec_id', 'spec_name');
```

## 使用方式

### Pad 端菜品管理
访问: `http://localhost:5173/pad/dishes`

功能:
- 左侧分类筛选
- 添加/编辑/删除菜品
- 快速修改价格
- 配置菜品规格(多规格/单价格)

### Pad 端点餐
- 点击带"多规格"标识的菜品会弹出规格选择
- 购物车显示规格信息

### Mobile 端点餐
- 同样支持规格选择弹窗
- 购物车支持规格展示
