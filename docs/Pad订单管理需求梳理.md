# Pad 端订单管理功能需求梳理

## 📋 需求分析

### 当前问题
1. **移动端点餐完成后跳转空白** - 需要修复
2. **Pad 端无法查看已点菜品** - 点击使用中的桌台，不知道点了什么
3. **无法查看菜品制作进度** - 不知道哪些菜在做、哪些已完成
4. **无法加菜** - 已有订单无法继续点餐
5. **无法结账** - 服务员需要在 Pad 上完成收款

### 目标用户场景
**服务员使用 Pad 的工作流程：**
1. 开台 → 进入点餐页面 → 选择菜品 → 提交订单
2. 查看已点菜品 → 跟踪制作进度 → 催菜/加菜
3. 顾客用餐完毕 → 确认账单 → 收款 → 完成订单
4. 清台 → 桌台恢复空闲

---

## 🎯 功能需求清单

### 1. 桌台状态识别（点击桌台时的逻辑）

| 桌台状态 | 当前行为 | 期望行为 |
|---------|---------|---------|
| 空闲 (绿) | 弹出开台对话框 | 开台 → 进入点餐页面 |
| 使用中 (红) | 直接进入点餐页面 | 显示选择：**点餐** / **查看订单** |
| 待清台 (黄) | 提示清台 | 显示账单 → 确认收款 → 清台 |

### 2. 订单详情页面（新增）

**页面功能：**
- [ ] 显示订单基本信息（桌号、人数、订单号、下单时间）
- [ ] 显示菜品列表（名称、数量、价格、状态）
  - [ ] 显示制作进度（待制作/制作中/已完成）

- [ ] 支持修改菜品状态（服务员可标记菜品完成）
- [ ] 显示订单金额（合计、应收）
- [ ] **加菜按钮** - 跳转回点餐页面
- [ ] **结账按钮** - 确认收款

**菜品状态流转：**
```
待制作 → 制作中 → 已完成 → 已上菜
   ↑        ↑         ↑
服务员可点击修改状态
```

### 3. 点餐页面优化

**当前问题：**
- 没有显示当前桌台的订单信息
- 提交订单后直接返回桌台，无法查看订单

**优化方案：**
- [ ] 顶部显示订单号、当前金额
- [ ] 如果是加菜模式，显示"加菜到现有订单"提示
- [ ] 提交订单后 → 跳转订单详情页（而非桌台列表）

### 4. 结账流程

**需求：**
- [ ] 显示应收金额
- [ ] 选择支付方式（现金/微信/支付宝）
- [ ] 确认收款 → 标记订单已支付
- [ ] 提供打印账单按钮（预留）

### 5. 移动端修复

**问题：** 点餐完成后跳转空白
**原因：** 订单提交后没有正确处理跳转
**修复：** 提交成功后显示"订单已提交"提示，并提供"返回首页"按钮

---

## 🛠 技术实现方案

### 方案 A：在点餐页面集成订单信息（推荐）

**思路：** 将"点餐"和"订单详情"融合在一个页面

**Pad点餐页面结构：**
```
┌─────────────────────────────────────────────────────────┐
│ [←] B01桌 4人  │ 订单: ORD20260226001  │ 合计: ¥258   │
├────────┬───────────────────────────────┬────────────────┤
│        │                               │                │
│ 菜品分类 │   菜品网格                    │  购物车+订单    │
│        │                               │  ────────────  │
│ 招牌菜  │   ┌─────────┐ ┌─────────┐    │  宫保鸡丁 x2   │
│  热菜   │   │ 菜品卡片 │ │ 菜品卡片 │    │  [待制作]     │
│  凉菜   │   │  [+]   │ │  [+]   │    │  ────────────  │
│        │   └─────────┘ └─────────┘    │  水煮鱼 x1     │
│  主食   │                               │  [制作中]     │
│        │                               │  ────────────  │
│        │                               │  米饭 x3       │
│        │                               │  [已完成]     │
│        │                               │                │
│        │                               │  [加菜]        │
│        │                               │  [结账]        │
└────────┴───────────────────────────────┴────────────────┘
```

**优点：**
- 服务员一站式操作，不用跳转页面
- 实时看到已点菜品和金额
- 可以随时加菜

**缺点：**
- 页面信息较多，需要合理布局

---

### 方案 B：分离页面（点餐页 + 订单详情页）

**思路：** 保持现有结构，新增独立的订单详情页

**流程：**
1. 开台 → 进入点餐页 → 提交订单 → 跳转订单详情
2. 订单详情页显示所有信息，提供"加菜"、"结账"按钮
3. 加菜 → 回到点餐页（带订单ID参数）

**优点：**
- 页面职责单一，结构清晰
- 和后厨页面风格统一

**缺点：**
- 需要页面跳转，操作步骤多

---

## ✅ 推荐方案：方案 A（集成式）

### 理由：
1. Pad 屏幕较大，可以容纳更多信息
2. 服务员效率优先，减少页面跳转
3. 类似美团收银等主流系统的设计

### 具体改动：

#### 1. 修改 Pad 桌台点击逻辑
```typescript
const handleTableClick = async (table: any) => {
  if (table.status === 0) {
    // 空闲：开台 → 进入点餐（新建订单模式）
  } else if (table.status === 1) {
    // 使用中：显示选项对话框
    // 选项1：继续点餐（加菜模式）
    // 选项2：查看订单（订单详情模式）
  } else if (table.status === 2) {
    // 待清台：显示结账对话框
  }
}
```

#### 2. 点餐页面新增右侧订单面板
- 顶部显示订单号、桌号、人数
- 中部显示已点菜品列表（可滚动）
- 每个菜品显示状态标签
- 底部显示金额和操作按钮

#### 3. 菜品状态更新
- 点击菜品行 → 弹出状态选择（待制作/制作中/已完成/已上菜）
- 同步调用 API 更新状态

#### 4. 结账功能
- 点击结账按钮 → 显示支付方式选择
- 确认收款 → 调用支付 API
- 支付成功后 → 提示"是否清台？"

---

## 📱 移动端修复

**问题：** 订单提交后跳转空白
**修复：**
```typescript
// 提交订单成功后
showToast('订单提交成功')
router.replace('/m/success') // 显示成功页面，而非空白

// 成功页面内容：
// - 订单号
// - 金额
// - "继续点餐" 按钮
// - "返回首页" 按钮
```

---

## 📋 API 接口检查

需要确认以下接口是否可用：

| 接口 | 用途 | 状态 |
|------|------|------|
| GET /api/orders/{id} | 获取订单详情 | ✅ 已测试 |
| POST /api/orders/{id}/add | 加菜 | ✅ 已有 |
| POST /api/orders/{id}/pay | 支付 | ✅ 已测试 |
| POST /api/orders/{id}/complete | 完成订单 | ✅ 已测试 |
| POST /api/orders/items/{id}/status | 更新菜品状态 | ✅ 已有 |

---

## ⏰ 开发时间预估

| 功能 | 预计时间 |
|------|---------|
| Pad 桌台点击逻辑优化 | 1h |
| 点餐页面右侧订单面板 | 3h |
| 菜品状态更新功能 | 1h |
| 结账流程 | 2h |
| 移动端跳转修复 | 0.5h |
| 测试调试 | 1h |
| **总计** | **约 8-9 小时** |

---

## ❓ 需要确认的问题

1. **是否需要在 Pad 上修改菜品状态？** 
   - 还是只由后厨页面修改？
   
2. **结账时是否需要选择支付方式？**
   - 还是统一标记为"现金"？
   
3. **是否需要在 Pad 上显示菜品图片？**
   - 当前列表模式，是否改为卡片模式？

4. **订单详情页面的权限？**
   - 是否只有开台的服务员可以操作？
   - 还是所有服务员都可以？

---

## ✅ 建议下一步

确认以上问题后，开始开发：
1. 先修改 Pad 桌台点击逻辑
2. 再优化点餐页面（集成订单面板）
3. 最后修复移动端跳转

请确认需求和方案，我可以立即开始开发。
